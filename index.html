<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beauty CRM Mini App</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-[#F9FAFB]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { 
            Calendar, Users, Settings, Plus, ChevronLeft, 
            Clock, MoreHorizontal, Home, Search
        } = lucide;

        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwWHWc0WTFj7CgDhN8Sx-LF5EjbQps3we_l8EeJ6crvd_vcH41XdIjlm-UJDnLO94BKFw/exec"; // Вставьте URL вашего Google Apps Script сюда

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [appointments, setAppointments] = useState([]);
            const [view, setView] = useState('main');

            // Моковые данные
            const mockData = [
                { id: 1, time: '10:00', name: 'Елена Иванова', service: 'Маникюр + Покрытие', price: 2500, status: 'done' },
                { id: 2, time: '12:30', name: 'Мария Петрова', service: 'Наращивание ресниц', price: 3500, status: 'pending' },
                { id: 3, time: '15:00', name: 'Анна Сидорова', service: 'Оформление бровей', price: 1200, status: 'pending' },
            ];

            useEffect(() => {
                setAppointments(mockData);
                // Интеграция с Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.ready();
                    window.Telegram.WebApp.expand();
                }
            }, []);

            const weekDays = useMemo(() => {
                const days = [];
                const today = new Date();
                for (let i = -3; i < 10; i++) {
                    const d = new Date();
                    d.setDate(today.getDate() + i);
                    days.push(d);
                }
                return days;
            }, []);

            const getDayName = (date) => date.toLocaleDateString('ru-RU', { weekday: 'short' });

            const Header = () => (
                <div className="px-6 pt-8 pb-4 bg-white sticky top-0 z-10 border-b border-gray-50">
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h1 className="text-2xl font-extrabold text-gray-900 tracking-tight">Привет, Анна!</h1>
                            <p className="text-gray-400 text-sm font-medium">У вас 4 записи на сегодня</p>
                        </div>
                        <div className="w-12 h-12 bg-purple-50 rounded-full flex items-center justify-center overflow-hidden border-2 border-purple-500 shadow-sm">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="avatar" />
                        </div>
                    </div>
                    
                    <div className="flex space-x-3 overflow-x-auto pb-2 scrollbar-hide">
                        {weekDays.map((date, idx) => {
                            const isSelected = date.toDateString() === selectedDate.toDateString();
                            return (
                                <button 
                                    key={idx}
                                    onClick={() => setSelectedDate(date)}
                                    className={`flex flex-col items-center min-w-[58px] p-3 rounded-2xl transition-all duration-300 ${
                                        isSelected ? 'bg-black text-white shadow-xl scale-105' : 'bg-gray-50 text-gray-400 hover:bg-gray-100'
                                    }`}
                                >
                                    <span className="text-[10px] uppercase font-bold mb-1">{getDayName(date)}</span>
                                    <span className="text-lg font-black">{date.getDate()}</span>
                                </button>
                            );
                        })}
                    </div>
                </div>
            );

            const AppointmentCard = ({ item }) => (
                <div className="bg-white mx-6 mb-4 p-5 rounded-[2rem] shadow-sm border border-gray-100 flex items-center active:scale-[0.97] transition-all duration-200">
                    <div className="flex flex-col items-center justify-center pr-5 border-r border-gray-100 min-w-[65px]">
                        <span className="text-sm font-black text-gray-900">{item.time}</span>
                        <div className="bg-purple-50 p-1 rounded-full mt-1">
                            <i data-lucide="clock" class="w-3 h-3 text-purple-600"></i>
                        </div>
                    </div>
                    <div className="pl-5 flex-1">
                        <h3 className="font-bold text-gray-900 text-base leading-tight">{item.name}</h3>
                        <p className="text-gray-400 text-xs font-medium mt-0.5">{item.service}</p>
                        <div className="mt-3 flex items-center justify-between">
                           <span className={`text-[10px] px-3 py-1 rounded-full font-bold uppercase tracking-wider ${
                             item.status === 'done' ? 'bg-green-50 text-green-600' : 'bg-orange-50 text-orange-600'
                           }`}>
                             {item.status === 'done' ? 'Выполнено' : 'Ожидание'}
                           </span>
                           <span className="text-base font-black text-purple-600">{item.price} ₽</span>
                        </div>
                    </div>
                </div>
            );

            const HomeView = () => (
                <div className="pb-32">
                    <Header />
                    <div className="mt-6">
                        <div className="px-6 flex justify-between items-end mb-4">
                            <h2 className="font-black text-xl text-gray-900">Записи</h2>
                            <button className="text-purple-600 text-sm font-bold bg-purple-50 px-3 py-1 rounded-lg">Все</button>
                        </div>
                        {appointments.map(item => <AppointmentCard key={item.id} item={item} />)}
                    </div>

                    <div className="px-6 grid grid-cols-2 gap-4 mt-6">
                        <div className="bg-purple-600 p-6 rounded-[2rem] text-white shadow-2xl shadow-purple-200 relative overflow-hidden">
                            <div className="relative z-10">
                                <p className="text-purple-100 text-[10px] font-bold uppercase tracking-widest mb-1">Доход сегодня</p>
                                <p className="text-2xl font-black">7 200 ₽</p>
                            </div>
                            <div className="absolute -right-2 -bottom-2 opacity-20 transform rotate-12">
                                <i data-lucide="trending-up" class="w-16 h-16"></i>
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-[2rem] border border-gray-100 shadow-sm">
                            <p className="text-gray-400 text-[10px] font-bold uppercase tracking-widest mb-1">Клиенты</p>
                            <p className="text-2xl font-black text-gray-900">+3</p>
                        </div>
                    </div>
                </div>
            );

            const AddAppointmentView = () => (
                <div className="p-6 bg-white min-h-screen">
                    <div className="flex items-center justify-between mb-8">
                        <button onClick={() => setView('main')} className="p-3 bg-gray-50 rounded-2xl">
                            <i data-lucide="chevron-left" class="w-6 h-6"></i>
                        </button>
                        <h1 className="text-xl font-black">Новая запись</h1>
                        <div className="w-12"></div>
                    </div>
                    <div className="space-y-6">
                        <div>
                            <label className="block text-[10px] font-black text-gray-400 mb-2 uppercase tracking-[0.2em] ml-2">Клиент</label>
                            <input type="text" placeholder="Введите имя или телефон" className="w-full bg-gray-50 border-2 border-transparent focus:border-purple-500 focus:bg-white transition-all rounded-[1.5rem] p-5 text-gray-900 font-medium" />
                        </div>
                        <div>
                            <label className="block text-[10px] font-black text-gray-400 mb-2 uppercase tracking-[0.2em] ml-2">Услуга</label>
                            <select className="w-full bg-gray-50 border-2 border-transparent rounded-[1.5rem] p-5 text-gray-900 font-medium appearance-none">
                                <option>Маникюр + Покрытие</option>
                                <option>Наращивание</option>
                                <option>Педикюр</option>
                            </select>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-[10px] font-black text-gray-400 mb-2 uppercase tracking-[0.2em] ml-2">Время</label>
                                <input type="time" className="w-full bg-gray-50 border-none rounded-[1.5rem] p-5 font-bold" />
                            </div>
                            <div>
                                <label className="block text-[10px] font-black text-gray-400 mb-2 uppercase tracking-[0.2em] ml-2">Цена</label>
                                <input type="number" placeholder="2500" className="w-full bg-gray-50 border-none rounded-[1.5rem] p-5 font-bold" />
                            </div>
                        </div>
                        <button className="w-full bg-black text-white font-black py-6 rounded-[2rem] shadow-2xl mt-8 active:scale-[0.98] transition-all tracking-wide">
                            ПОДТВЕРДИТЬ ЗАПИСЬ
                        </button>
                    </div>
                </div>
            );

            // Инициализация иконок после каждого рендера
            useEffect(() => {
                lucide.createIcons();
            });

            return (
                <div className="max-w-md mx-auto bg-[#F9FAFB] min-h-screen relative overflow-x-hidden">
                    {view === 'main' ? (
                        <>
                            {activeTab === 'home' && <HomeView />}
                            {activeTab === 'clients' && (
                                <div className="p-6">
                                    <h1 className="text-2xl font-black mb-6">Мои клиенты</h1>
                                    <div className="relative mb-6">
                                        <input type="text" placeholder="Поиск по базе..." className="w-full bg-white border border-gray-100 rounded-2xl p-4 pl-12 shadow-sm font-medium" />
                                        <div className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-300">
                                            <i data-lucide="search" class="w-5 h-5"></i>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-[2.5rem] p-10 border border-gray-100 shadow-sm text-center">
                                        <div className="w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <i data-lucide="users" class="w-10 h-10 text-gray-200"></i>
                                        </div>
                                        <p className="text-gray-400 font-bold">Список клиентов пуст</p>
                                        <p className="text-gray-300 text-xs mt-1">Добавьте первого клиента вручную или через запись</p>
                                    </div>
                                </div>
                            )}

                            {/* Floating Action Button */}
                            <button 
                                onClick={() => setView('add-appointment')}
                                className="fixed bottom-28 right-6 w-16 h-16 bg-purple-600 text-white rounded-[1.5rem] flex items-center justify-center shadow-2xl shadow-purple-300 z-20 active:scale-90 transition-all active:rotate-45"
                            >
                                <i data-lucide="plus" class="w-8 h-8"></i>
                            </button>

                            {/* Bottom Navigation */}
                            <div className="fixed bottom-6 left-6 right-6 bg-black/90 backdrop-blur-xl rounded-[2.5rem] px-8 py-5 flex justify-between items-center z-30 shadow-2xl">
                                <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center transition-all ${activeTab === 'home' ? 'text-purple-400 scale-110' : 'text-gray-500'}`}>
                                    <i data-lucide="home" class="w-6 h-6"></i>
                                </button>
                                <button onClick={() => setActiveTab('calendar')} className={`flex flex-col items-center transition-all ${activeTab === 'calendar' ? 'text-purple-400 scale-110' : 'text-gray-500'}`}>
                                    <i data-lucide="calendar" class="w-6 h-6"></i>
                                </button>
                                <button onClick={() => setActiveTab('clients')} className={`flex flex-col items-center transition-all ${activeTab === 'clients' ? 'text-purple-400 scale-110' : 'text-gray-500'}`}>
                                    <i data-lucide="users" class="w-6 h-6"></i>
                                </button>
                                <button onClick={() => setActiveTab('settings')} className={`flex flex-col items-center transition-all ${activeTab === 'settings' ? 'text-purple-400 scale-110' : 'text-gray-500'}`}>
                                    <i data-lucide="settings" class="w-6 h-6"></i>
                                </button>
                            </div>
                        </>
                    ) : (
                        <AddAppointmentView />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
